<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ClamAV Security Scanner</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      background-image: url(../static/network2.jpg);
      background-size: cover;
      background-repeat: no-repeat;
      font-family: 'Segoe UI', sans-serif;
      color: white;
      padding: 2rem;
    }

    .glass {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 2rem;
      backdrop-filter: blur(14px);
      box-shadow: 0 0 40px rgba(0, 255, 200, 0.15);
      max-width: 900px;
      margin: auto;
      border: 1px solid rgba(0, 255, 200, 0.2);
    }

    .header-icon {
      height: 100px; /* Reduced icon size */
      width: auto;
      margin-right: 10px;
      vertical-align: middle;
    }

    .header-title {
      display: inline-flex;
      align-items: center;
      vertical-align: middle;
    }

    .btn-scan {
      background-color: #00ffc8;
      color: #000;
      font-weight: bold;
      border: none;
      padding: 0.6rem 1.5rem;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .btn-scan:hover {
      background-color: #02cba0;
      transform: scale(1.03);
    }

    .form-control {
      background-color: #1d1f23;
      color: white;
      border: 1px solid #00ffc8;
      border-radius: 8px;
    }

    .form-label {
      color: #ccc;
      font-weight: 600;
    }

    .output-box {
      background-color: #0e1116;
      padding: 1rem;
      border-radius: 10px;
      margin-top: 1rem;
      max-height: 300px;
      overflow-y: auto;
      font-family: monospace;
      border: 1px solid #00ffc8;
      white-space: pre-wrap;
      color: #90ee90;
    }

    .scan-status {
      margin-top: 1rem;
      font-weight: bold;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      color: #00ff91;
    }

    .progress {
      margin-top: 1rem;
      height: 20px;
      border-radius: 10px;
      overflow: hidden;
    }

    .progress-bar {
      background-color: #00ffc8;
    }

    .header-data {
      font-size: 0.95rem;
      color: #aaa;
      margin-bottom: 1.2rem;
    }

    #clock {
      font-weight: bold;
      color: #ffb347;
    }

    #ip {
      font-weight: bold;
      color: #ffb347;
    }

    #os {
      font-weight: bold;
      color: #ffb347;
    }
  </style>
</head>
<body>

  <div class="glass">
    <h2 class="mb-4 text-center">
      <span class="header-title">
        <img src="../static/ClamAV.svg" alt="ClamAV Logo" class="header-icon">KYGnus solution for ClamAV
      </span>
    </h2>

    <div class="header-data">
      <div>üïí Time: <span id="clock">{{ time }}</span></div>
      <div>üåê IP Address: <span id="ip"> {{ ip }}  </span></div>
      <div>üíª Detected OS: <span id="os">  {{ os }} </span></div>
      <div id="remote_info" class="mt-3 text-info" style="display: none;"></div>
    </div>

    <form id="scanForm">
      <div class="mb-3">
        <label for="scan_path" class="form-label">Directory to Scan</label>
        <input type="text" class="form-control" id="scan_path" name="scan_path" placeholder="/var/www or C:\\Users" required>
      </div>

      <div class="mb-3">
        <label for="remote_host" class="form-label">Remote IP (optional)</label>
        <input type="text" class="form-control" id="remote_host" name="remote_host" placeholder="192.168.1.101">
      </div>

      <div class="mb-3">
        <label for="remote_user" class="form-label">Remote Username</label>
        <input type="text" class="form-control" id="remote_user" name="remote_user" placeholder="e.g. admin">
      </div>

      <div class="mb-3">
        <label for="remote_pass" class="form-label">Remote Password</label>
        <input type="password" class="form-control" id="remote_pass" name="remote_pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
      </div>

      <button type="submit" class="btn btn-scan">üîç Start Scan</button>
    </form>

    <div id="status" class="scan-status"></div>
    <div class="progress" style="display: none;">
      <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
    </div>

    <div id="output" class="output-box"></div>
  </div>

  <script>
    const form = document.getElementById('scanForm');
    const outputBox = document.getElementById('output');
    const status = document.getElementById('status');
    const progressBar = document.getElementById('progressBar');
    const progressContainer = document.querySelector('.progress');

    // Update clock every second
    setInterval(() => {
      const now = new Date();
      document.getElementById('clock').textContent =
        now.toLocaleTimeString('en-GB', { hour12: false });
    }, 1000);

    form.addEventListener('submit', function (e) {
      e.preventDefault();
      outputBox.innerHTML = '';
      progressBar.style.width = "0%";
      progressContainer.style.display = "block";
      status.textContent = 'üîÑ Initializing scan...';

      const scanPath = document.getElementById('scan_path').value;
      const remoteHost = document.getElementById('remote_host').value;
      const remoteUser = document.getElementById('remote_user').value;
      const remotePass = document.getElementById('remote_pass').value;

      const params = new URLSearchParams({
        scan_path: scanPath,
        remote_host: remoteHost,
        remote_user: remoteUser,
        remote_pass: remotePass
      });

      const eventSource = new EventSource('/scan?' + params.toString());

      let progress = 0;
      eventSource.onmessage = function (event) {
        outputBox.innerHTML += event.data + "\n";
        outputBox.scrollTop = outputBox.scrollHeight;

        if (event.data.startsWith("üíª Remote OS:")) {
          document.getElementById('remote_info').style.display = 'block';
          document.getElementById('remote_info').innerText = event.data.replace("data: ", "");
        }

        if (event.data.includes('‚úÖ')) {
          status.textContent = '‚úÖ Scan completed.';
          eventSource.close();
        }
      };

      eventSource.onerror = function () {
        status.textContent = '‚ùå Scan aborted or failed.';
        eventSource.close();
      };
    });
  </script>
</body>
</html>
