<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Network Topology - clamNET</title>

  <!-- Cytoscape.js -->
  <script src="https://unpkg.com/cytoscape@3.25.0/dist/cytoscape.min.js"></script>

  <!-- Bootstrap + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>

  <style>
    body {
      background: radial-gradient(ellipse at center, #000000cb 0%, #151515 100%);
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
    }

    .text-glow {
      color: #ffffff;
      text-shadow: 0 0 10px rgba(0, 255, 255, 0.6);
    }

    #cy {
      width: 100%;
      height: 600px;
      display: block;
      border-radius: 10px;
      margin: 20px auto;
      filter: drop-shadow(0 0 10px #00fff7aa);
      background: #000000;
    }

    .header, .footer {
      text-align: center;
      padding: 20px;
    }

    .footer {
      font-size: 13px;
      color: #aaa;
    }

    .header img {
      height: 50px;
    }
  </style>
</head>
<body>

  <!-- Header -->
  <div class="header">
    <img src="https://upload.wikimedia.org/wikipedia/commons/9/99/Crystal_Clear_app_network.png" alt="Logo" />
    <h1 class="text-glow">clamNET - Network Topology</h1>
    <p>Scanned Network: <strong>{{ network }}</strong></p>
  </div>

  <!-- Graph Container -->
  <div id="cy"></div>

  <!-- Footer -->
  <div class="footer">
    &copy; 2025 clamNET. All rights reserved.
  </div>

  <!-- Graph Script -->
  <script>
    const hosts = {{ hosts | tojson }};

    // Create Cytoscape elements
    let elements = [];

    // Central router/switch node
    elements.push({
      data: { id: 'router', label: 'Router / Gateway' },
      classes: 'router'
    });

    hosts.forEach((host, index) => {
      const nodeId = 'host' + index;
      elements.push({
        data: {
          id: nodeId,
          label: `${host.hostname || host.ip}`,
          os: host.os,
          ip: host.ip,
          ttl: host.ttl
        },
        classes: host.os.toLowerCase()
      });

      // Connect host to router
      elements.push({
        data: { source: 'router', target: nodeId }
      });
    });

    cytoscape({
      container: document.getElementById('cy'),
      elements: elements,
      style: [
        {
          selector: 'node',
          style: {
            'background-color': '#00fff7',
            'label': 'data(label)',
            'color': '#fff',
            'text-valign': 'center',
            'text-halign': 'center',
            'text-outline-color': '#111',
            'text-outline-width': 2,
            'width': 50,
            'height': 50,
            'font-size': 10
          }
        },
        {
          selector: 'node.router',
          style: {
            'background-color': '#ff0044',
            'shape': 'rectangle',
            'width': 60,
            'height': 40,
            'font-weight': 'bold'
          }
        },
        {
          selector: 'node.windows',
          style: {
            'background-image': 'url(https://upload.wikimedia.org/wikipedia/commons/4/48/Windows_logo_-_2021.svg)',
            'background-fit': 'cover',
            'border-color': '#0078D6',
            'border-width': 2
          }
        },
        {
          selector: 'node.linux',
          style: {
            'background-image': 'url(https://upload.wikimedia.org/wikipedia/commons/a/af/Tux.png)',
            'background-fit': 'cover',
            'border-color': '#fcd000',
            'border-width': 2
          }
        },
        {
          selector: 'edge',
          style: {
            'width': 2,
            'line-color': '#00fff7',
            'target-arrow-color': '#00fff7',
            'target-arrow-shape': 'triangle'
          }
        }
      ],
      layout: {
        name: 'cose',
        padding: 20,
        animate: true
      }
    });
  </script>

</body>
</html>
